<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>q2_feature_table : summarize</title>
    <link rel="stylesheet" href="./q2templateassets/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="./q2templateassets/css/normalize.css"/>
    <link rel="stylesheet" href="./q2templateassets/css/base-template.css"/>
    <script src="./q2templateassets/js/jquery-3.2.0.min.js" charset="utf-8"></script>
    <script src="./q2templateassets/js/bootstrap.min.js" charset="utf-8"></script>
    
<script src="js/vega.min.js"></script>
<script src="js/vega-embed.min.js"></script>
<script src="util.js"></script>
<link rel="stylesheet" type="text/css" href="css/spinkit.css" /> 
  </head>
  <body>
    <div class="container-fluid">
      <div id="q2templatesheader" class="row">
        <div class="col-lg-12">
          <a href="http://qiime2.org/">
            <img src="./q2templateassets/img/qiime2-rect-200.png"
            alt="QIIME 2">
          </a>
        </div>
      </div>
        

  <div class="row">
    <div class="col-lg-12">
      <ul class="nav nav-tabs">
        
          <li class="">
            <a href="index.html">
              Overview
            </a>
          </li>
        
          <li class="active">
            <a href="sample-frequency-detail.html">
              Interactive Sample Detail
            </a>
          </li>
        
          <li class="">
            <a href="feature-frequency-detail.html">
              Feature Detail
            </a>
          </li>
        
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      


<div class="row">
  <div class="col-lg-4">
    <div class="row">
      <div class="col-lg-12" id="sampling-depth-slider">
        <label> Sampling Depth &nbsp; </label> <br>
        <input id="range-slider" type="range" min="0" max="299732.0" value="0" class="slider" oninput="sliderHelperFunction(this.value);"> <br>
        <input id="text-box" class="form-control" type="number" value="0" min="0" oninput="textBoxHelperFunction(this.value);"/>
        <br>
        (zero implies no even sampling)
        <div class="row">
          <div class="col-lg-12" id="text-field"></div>
        </div>
      </div>
    </div>
  </div>
</div>



<div class="row">
  <div class="col-lg-8">
    <table id="feature-table" class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Sample ID</th>
          <th scope="col">Frequency</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>
</div>

<script id="table-data" type="application/json">
{"Frequency":{"EG0024":142614.0,"EG0031":153808.0,"EG0039":101548.0,"EG0055":200678.0,"EG0057":167790.0,"EG0070":251107.0,"EG0088":161176.0,"EG0101":195072.0,"EG0118":157102.0,"EG0136":102482.0,"EG0141":151569.0,"EG0175":183084.0,"EG0194":150850.0,"EG0196":168535.0,"EG0236":107240.0,"EG0256":160070.0,"EG0280":166429.0,"EG0282":138162.0,"EG0294":96829.0,"EG0303":132043.0,"EG0313":109206.0,"EG0341":216588.0,"EG0364":115763.0,"EG0365":140343.0,"EG0381":121736.0,"EG0401":187372.0,"EG0415":71370.0,"EG0447":170878.0,"EG0497":158376.0,"EG0520":190978.0,"EG0546":153431.0,"EG0605":174751.0,"EG0647":194801.0,"EG0660":161977.0,"EG0732":101918.0,"EG0744":289507.0,"EG0767":81147.0,"EG0778":75833.0,"EG0800":94167.0,"EG0831":73323.0,"EG0850":200119.0,"EG0883":224089.0,"EG0892":155919.0,"EG0927":104468.0,"EG0946":132048.0,"EG0967":246984.0,"EG0968":82.0,"EG1035":145821.0,"EG1041":154074.0,"EG1051":105326.0,"EG1069":128053.0,"EG1080":82295.0,"EG1153":79.0,"EG1178":150175.0,"EG1359":299156.0,"EG1394":58526.0,"EG1416":127897.0,"EG1431":81208.0,"EG1490":158790.0,"EG1507":135423.0,"EG1524":275845.0,"EG1527":7.0,"EG1572":92666.0,"EG1599":184029.0,"EG1637":193152.0,"EG1673":200615.0,"EG1724":191476.0,"EG1772":74.0,"EG1823":277444.0,"EG1825":171934.0,"EG1830":152586.0,"EG1872":188828.0,"EG1878":109896.0,"EG1892":112712.0,"EG1904":179352.0,"EG1905":221152.0,"EG1915":171476.0,"EG1939":134618.0,"EG1940":175687.0,"EG1976":180377.0,"EG1990":147499.0,"EG2018":149697.0,"EG2149":158843.0,"EG2186":152833.0,"EG2214":271975.0,"EG2226":25.0,"EG2279":251959.0,"EG2335":62590.0,"EG2391":224710.0,"EG2392":206092.0,"EG2419":184604.0,"EG2435":170680.0,"EG2473":79.0,"EG2490":228161.0,"EG2518":73.0,"EG2537":75.0,"EG2559":299732.0,"EG2580":212809.0,"EG2591":161668.0,"EG2608":231901.0,"EG2638":295206.0,"EG2659":98799.0}}
</script>

<script type="text/javascript">
  var totalFrequencies = 15386121;
  var sampleCount = 102;
  var defaultDescription = "Retained " + (totalFrequencies.toLocaleString('en'))
                                       + " (100.00%) features in "
                                       + sampleCount + " (100.00%) samples at the specifed sampling depth.";


  var textField = document.getElementById('text-field');
  var tableBody = document.getElementById("table-body");
  var table = document.getElementById("feature-table");

  // when the viz loads the default description is displayed
  textField.innerHTML = defaultDescription;

  let sampleTable = JSON.parse(document.getElementById("table-data").innerHTML);
  let sampleFrequencies = sampleTable["Frequency"];
  // get object keys and store them in an ascending order based on the key value
  // this order is used to create the table rows
  sortedSampleIDs = Object.keys(sampleFrequencies).sort(function(a, b) {
    return sortIDs(a, b, sampleFrequencies)
  });

  formatTable(tableBody, sampleTable, sortedSampleIDs);

  function updateTableandText(samplingDepth) {
    let retainedSampleCount = 0;

    // start the counter at 1 to ignore the header row
    for (var i = 1; row = table.rows[i]; i++) {
      // The value in table is formatted as a string for display to the user,
      // but the value in sampleFrequencies is formatted as an int for data
      // manipulation, so we use the ID we are on in table to get the frequency
      // from sampleFrequencies.
      const sampleID = row.cells[0].innerText;
      const sampleFrequency = sampleFrequencies[sampleID];

      if (sampleFrequency < samplingDepth) {
        row.className = "danger";
      } else {
        row.className = "";
        retainedSampleCount += 1;
      }
    }
    if (samplingDepth == 0){
      textField.innerHTML = defaultDescription;
    }
    else{
      var retainedFeatureCount = retainedSampleCount * samplingDepth;
      textField.innerHTML = "Retained " + formatter.format(retainedFeatureCount)
                                        + " (" + (retainedFeatureCount/totalFrequencies*100).toFixed(2) + "%) features in "
                                        + retainedSampleCount + " (" + (retainedSampleCount/sampleCount*100).toFixed(2)
                                        +  "%) samples at the specifed sampling depth.";
    }
  }


  function updateSliderVal(val) {
    var slider = document.getElementById("range-slider");
    slider.value = val;
    slider.dispatchEvent(new Event("change"));
    slider.dispatchEvent(new Event("input"));
  }


  function updateBoxVal(val) {
    var num = document.getElementById("text-box");
    num.value = val;
  }


  function sliderHelperFunction(val){
    updateBoxVal(val);
    updateTableandText(val);
  }


  function textBoxHelperFunction(val){
    val = parseInt(val);
    if (val !== val) {
      val = 0;
    }

    // make sure the value in the textbox cannot exceed the max count
    if (val > 299732.0){
      var num = document.getElementById("text-box");
      num.value = 299732.0;
    }
    updateSliderVal(val);
  }
</script>


    </div>
  </div>


    </div>
    <script type="text/javascript">
      if (window.frameElement) {
          document.getElementById('q2templatesheader').remove();
      }
    </script>
    

  </body>
</html>